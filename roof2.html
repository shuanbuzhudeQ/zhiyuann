<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¸æ€¨â€”â€”å†æ¬¡å¤©å°</title>
    <link rel="stylesheet" href="css/main.css">
    
    <style>
        /* ==================== åœºæ™¯ç‰¹æœ‰æ ·å¼ ==================== */
        /* åœºæ™¯å®¹å™¨æ ·å¼è°ƒæ•´ */
        .scene-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        /* äººç‰©ç«‹ç»˜å®¹å™¨ - è°ƒæ•´é«˜åº¦å å±å¹•æ›´å¤š */
        .character-avatar-container {
            position: absolute;
            bottom: 0; /* æ”¹ä¸º0ï¼Œè®©å®¹å™¨åº•éƒ¨è´´ç€å±å¹•åº•è¾¹ */
            width: 100%;
            height: 70%; /* å¢åŠ ç«‹ç»˜å®¹å™¨é«˜åº¦åˆ°70% */
            z-index: 5;
            pointer-events: none;
        }
        
        /* äººç‰©ç«‹ç»˜ - å¢å¤§å°ºå¯¸ */
        .character-avatar-img {
            position: absolute;
            bottom: 0; /* æ”¹ä¸º0ï¼Œè®©ç«‹ç»˜åº•éƒ¨è´´ç€å®¹å™¨åº•éƒ¨ */
            max-height: 100%; /* æ”¹ä¸º100%ï¼Œè®©ç«‹ç»˜å¯ä»¥å æ»¡å®¹å™¨é«˜åº¦ */
            max-width: 60%; /* å¢åŠ æœ€å¤§å®½åº¦åˆ°60% */
            width: auto; /* æ·»åŠ è¿™ä¸ª */
            height: auto; /* æ·»åŠ è¿™ä¸ª */
            object-fit: contain;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.5));
        }
        
        /* äººç‰©ç«‹ç»˜åœ¨å·¦ä¾§ */
        .character-left {
            left: 5%;
        }
        
        /* äººç‰©ç«‹ç»˜åœ¨å³ä¾§ */
        .character-right {
            right: 5%;
        }
        
        /* å¯¹è¯æ¡†å®¹å™¨ - è°ƒæ•´é«˜åº¦ */
        .dialogue-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30%; /* å‡å°å¯¹è¯æ¡†å®¹å™¨é«˜åº¦åˆ°30%ï¼Œç»™ç«‹ç»˜æ›´å¤šç©ºé—´ */
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            pointer-events: none;
        }
        
        /* å¯¹è¯æ¡† */
        .dialogue-box {
            background-color: rgba(0, 0, 0, 0.85);
            border: 2px solid #4ecdc4;
            border-radius: 10px;
            padding: 20px;
            margin: 0 20px 20px 20px;
            min-height: 120px;
            max-height: 180px; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            overflow-y: auto; /* æ·»åŠ æ»šåŠ¨æ¡ */
            overflow-x: hidden;
        }
        
        /* å¯¹è¯æ¡†æ»šåŠ¨æ¡æ ·å¼ */
        .dialogue-box::-webkit-scrollbar {
            width: 8px;
        }
        
        .dialogue-box::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .dialogue-box::-webkit-scrollbar-thumb {
            background: #4ecdc4;
            border-radius: 4px;
        }
        
        .dialogue-box::-webkit-scrollbar-thumb:hover {
            background: #3abbb2;
        }
        
        /* å¯¹è¯æ¡†æ ‡é¢˜ */
        .dialogue-title {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
        }
        
        .title-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        /* å¯¹è¯æ¡†æ–‡æœ¬ */
        .dialogue-text {
            font-size: 16px;
            line-height: 1.5;
            color: #fff;
            margin-bottom: 10px;
        }
        
        /* å¯¹è¯æ¡†æç¤º */
        .dialogue-hint {
            text-align: right;
            font-size: 14px;
            color: #ffcc00;
            font-style: italic;
            margin-top: 10px;
        }
        
        /* æ—ç™½æ¡†æ ·å¼ */
        .narration-box {
            background-color: rgba(0, 0, 0, 0.85);
            border: 2px solid #4ecdc4;
            border-radius: 10px;
            padding: 20px;
            margin: 0 20px 20px 20px;
            min-height: 120px;
            max-height: 180px; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            overflow-y: auto; /* æ·»åŠ æ»šåŠ¨æ¡ */
            overflow-x: hidden;
        }
        
        /* æ—ç™½æ¡†æ»šåŠ¨æ¡æ ·å¼ */
        .narration-box::-webkit-scrollbar {
            width: 8px;
        }
        
        .narration-box::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .narration-box::-webkit-scrollbar-thumb {
            background: #4ecdc4;
            border-radius: 4px;
        }
        
        .narration-box::-webkit-scrollbar-thumb:hover {
            background: #3abbb2;
        }
        
        /* éšè—ç±» */
        .hidden {
            display: none !important;
        }
        
        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® - æ”¾åœ¨åœºæ™¯åŒºå³ä¸Šè§’ */
        .music-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            font-size: 20px;
            color: white;
        }
        
        /* åœºæ™¯èƒŒæ™¯å›¾ç‰‡ */
        .scene-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        /* ==================== ç« èŠ‚è¿‡æ¸¡åŠ¨ç”»æ ·å¼ ==================== */
        .chapter-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
        }
        
        .chapter-transition.active {
            display: flex;
            opacity: 1;
            pointer-events: auto;
        }
        
        .chapter-text {
            font-family: 'UnifrakturMaguntia', "Old English Text MT", "Gothic", serif;
            font-size: 48px;
            color: #8b0000; /* æ·±çº¢è‰²ï¼Œæ›´ææ€– */
            text-align: center;
            opacity: 0;
            text-shadow: 
                0 0 5px #8b0000,
                0 0 10px #8b0000,
                0 0 15px #600000,
                0 0 20px #400000;
            letter-spacing: 3px;
            line-height: 1.3;
            padding: 0 20px;
            transform: scale(0.9);
        }
        
        /* å­—ä½“å›é€€æ–¹æ¡ˆ */
        @import url('https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap');
        
        /* ==================== åŠ¨ç”»å…³é”®å¸§ ==================== */
        /* ç«‹ç»˜æ·¡å…¥åŠ¨ç”» */
        @keyframes avatarFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å¯¹è¯æ¡†æ·¡å…¥åŠ¨ç”» */
        @keyframes dialogueFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ç« èŠ‚æ–‡å­—åŠ¨ç”» */
        @keyframes chapterFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes chapterFadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <!-- ç« èŠ‚è¿‡æ¸¡é¡µé¢ -->
    <div class="chapter-transition" id="chapter-transition">
        <div class="chapter-text" id="chapter-text">å†è§äº†ï¼ŒåŸ‹è—ä¸ƒå¹´çš„ç½ªæ¶</div>
    </div>
    
    <!-- èƒŒæ™¯éŸ³ä¹ - æ·»åŠ  autoplay å±æ€§ -->
    <audio id="bgm" src="res/ç»“å±€.mp3" loop autoplay></audio>
    
    <div class="game-container">
        <a href="map.html" class="map-link">å›åˆ°åœ°å›¾</a>
        
        <div class="scene-area scene-container">
            <!-- åœºæ™¯ï¼šå¤©å° -->
            <div class="scene" id="scene1">
                <div class="scene-content">
                    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’®æ”¾åœ¨åœºæ™¯åŒºå³ä¸Šè§’ -->
                    <div class="music-btn" onclick="toggleMusic()">ğŸ”Š</div>
                    
                    <img src="res/å¤©å°.jpg" alt="å¤©å°" class="scene-bg">
                    
                    <!-- äººç‰©ç«‹ç»˜å®¹å™¨ -->
                    <div class="character-avatar-container" id="character-avatar-container"></div>
                    
                    <!-- å¯¹è¯æ¡†å®¹å™¨ -->
                    <div class="dialogue-container" id="dialogue-container">
                        <!-- åˆå§‹æ—ç™½ -->
                        <div class="narration-box" id="narration-box">
                            <div class="dialogue-text" id="narration-content">
                                å†æ¬¡è¸ä¸Šå¤©å°ï¼Œå¿ƒå¢ƒå·²ä¸æ•°å°æ—¶å‰æˆªç„¶ä¸åŒï¼Œé‚£æ—¶å¿ƒé‡Œæ»¡æ˜¯çŒå¥‡ä¸ç®—è®¡ï¼Œç°åœ¨åªå‰©ä¸‹èµ¤è£¸è£¸çš„ææƒ§ä¸å³å°†è¢«å…¬å¼€å¤„åˆ‘çš„ç»æœ›ã€‚
                            </div>
                            <div class="dialogue-hint">æç¤ºï¼šç‚¹å‡»å±å¹•ä»»æ„ä½ç½®ç»§ç»­</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç›´æ’­è¯„è®ºåŒº -->
        <div class="live-area">
            <div class="live-header">
                <h3 class="live-title">ç›´æ’­é—´è¯„è®ºåŒº</h3>
                <span class="viewer-count">åœ¨çº¿äººæ•°: <span id="viewer-count">5448753</span></span>
            </div>
            
            <div class="comment-area" id="comment-area">
            </div>
            
            <div class="comment-input">
                <input type="text" placeholder="å‘é€ä½ çš„è¯„è®º..." id="comment-input">
            </div>
        </div>
    </div>

    <script>
        // ==================== æ¸¸æˆçŠ¶æ€ç®¡ç† ====================
        const gameState = {
            currentDialogueIndex: 0,
            isWaitingForClick: false,
            clickCallback: null,
            characters: {
                æ—æ™šæ™´: { position: 'right', color: '#4ecdc4' },
                ç‹é¹: { position: 'left', color: '#95e1d3' },
                å­™è–‡è–‡: { position: 'left', color: '#f8a5c2' },
                æ²ˆå¢¨è¨€: { position: 'left', color: '#778beb' },
                èµµå¥: { position: 'left', color: '#f19066' }
            },
            currentCharacter: null,
            currentAvatar: null,
            isTransitioning: false
        };
        
        // ==================== DOMå…ƒç´ å¼•ç”¨ ====================
        const elements = {
            narrationBox: document.getElementById('narration-box'),
            narrationContent: document.getElementById('narration-content'),
            commentArea: document.getElementById('comment-area'),
            viewerCount: document.getElementById('viewer-count'),
            dialogueContainer: document.getElementById('dialogue-container'),
            characterAvatarContainer: document.getElementById('character-avatar-container'),
            chapterTransition: document.getElementById('chapter-transition'),
            chapterText: document.getElementById('chapter-text')
        };
        
        // ==================== éŸ³ä¹æ§åˆ¶ ====================
        let isPlaying = true; 
        const bgm = document.getElementById('bgm');
        const musicBtn = document.querySelector('.music-btn');
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ’­æ”¾éŸ³ä¹
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®éŸ³é‡
            bgm.volume = 0.7;
            
            // å°è¯•è‡ªåŠ¨æ’­æ”¾
            bgm.play().then(() => {
                console.log('éŸ³ä¹è‡ªåŠ¨æ’­æ”¾æˆåŠŸ');
                isPlaying = true;
                musicBtn.textContent = 'ğŸ”Š';
            }).catch(err => {
                console.log('è‡ªåŠ¨æ’­æ”¾å¯èƒ½è¢«æµè§ˆå™¨é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:', err);
                // å³ä½¿è¢«é˜»æ­¢ï¼Œä¹Ÿä¿æŒæ’­æ”¾çŠ¶æ€
                isPlaying = true;
                musicBtn.textContent = 'ğŸ”Š';
            });
        });
        
        // ç‚¹å‡»éŸ³ä¹æŒ‰é’®åˆ‡æ¢æ’­æ”¾/æš‚åœ
        function toggleMusic() {
            if (isPlaying) {
                bgm.pause();
                musicBtn.textContent = 'ğŸ”‡';
                isPlaying = false;
            } else {
                bgm.play();
                musicBtn.textContent = 'ğŸ”Š';
                isPlaying = true;
            }
        }
        
        // ==================== ç« èŠ‚è¿‡æ¸¡åŠ¨ç”» ====================
        function showChapterTransition() {
            gameState.isTransitioning = true;
            
            // æ˜¾ç¤ºç« èŠ‚è¿‡æ¸¡å±‚
            elements.chapterTransition.classList.add('active');
            
            // æ–‡å­—æ¸ç°åŠ¨ç”»
            setTimeout(() => {
                elements.chapterText.style.cssText = `
                    opacity: 1;
                    transform: scale(1);
                    transition: all 1.5s ease-out;
                `;
            }, 100);
            
            // 1.5ç§’åå¼€å§‹æ¸éš
            setTimeout(() => {
                elements.chapterText.style.cssText = `
                    opacity: 0;
                    transform: scale(1.1);
                    transition: all 1s ease-in;
                `;
                
                // æ•´ä¸ªå±‚æ¸éš
                setTimeout(() => {
                    elements.chapterTransition.classList.remove('active');
                    elements.chapterText.style.cssText = `
                        opacity: 0;
                        transform: scale(0.9);
                        transition: none;
                    `;
                    
                    gameState.isTransitioning = false;
                    
                    // æ˜¾ç¤ºæ–°é—»é¡µé¢é“¾æ¥
                    showNewsLink();
                }, 1000);
            }, 1500);
        }
        
        // ==================== å¼¹å¹•å†…å®¹ ====================
        const commentsData = {
            å¤©å°å¼€åœº: [
                { user: 'ç½‘å‹', text: 'ç»ˆäºå›åˆ°å¤©å°äº†ï¼' },
                { user: 'è§‚å¯Ÿå‘˜', text: 'æ°”æ°›å®Œå…¨ä¸ä¸€æ ·äº†' },
                { user: 'å¿ƒç†ä¸“å®¶', text: 'å¿ƒæ€ä»çŒå¥‡å˜æˆäº†ææƒ§' }
            ],
            åˆå¤œé™ä¸´: [
                { user: 'æ—¶é—´è®°å½•è€…', text: 'åˆå¤œ0ç‚¹ï¼Œæœ€é»‘æš—çš„æ—¶åˆ»' },
                { user: 'ææ€–ç‰‡çˆ±å¥½è€…', text: 'ç»å…¸ææ€–ç‰‡æ—¶é—´è®¾å®šï¼' },
                { user: 'ç½‘å‹', text: 'çœŸæ­£çš„å®¡åˆ¤è¦å¼€å§‹äº†' }
            ],
            å››äººçç‰©: [
                { user: 'è€ƒå¤å­¦å®¶', text: 'è¿™äº›æ˜¯ä»–ä»¬å½“å¹´æœ€çè§†çš„ä¸œè¥¿' },
                { user: 'è€åŒå­¦', text: 'æ—æ™šæ™´çš„å¥–çŠ¶ã€èµµå¥çš„ç¯®çƒç…§ç‰‡ã€å­™è–‡è–‡çš„ç£å¸¦ã€ç‹é¹çš„é’¢ç¬”' },
                { user: 'ç½‘å‹', text: 'æ²ˆå¢¨è¨€è¿è¿™äº›éƒ½çŸ¥é“ï¼' }
            ],
            è‹ç­±èŠ·çå®: [
                { user: 'ç‰¹æ®Šç½‘å‹', text: 'è‹ç­±èŠ·çš„çå®æ˜¯å–„æ„ã€æ‰åã€çº¸é£æœº...' },
                { user: 'ç½‘å‹', text: 'è¿˜æœ‰å¯¹æœ‹å‹å’Œè®¤å¯çš„å‘å¾®æ¸´æœ›' },
                { user: 'æƒ…æ„Ÿåˆ†æå¸ˆ', text: 'å¥½å¿ƒç–¼å°çº¸' }
            ],
            æ²ˆå¢¨è¨€è´¨é—®: [
                { user: 'å®¡åˆ¤è€…', text: 'ä½ ä»¬è·µè¸äº†å¥¹çš„çå®ï¼' },
                { user: 'ç½‘å‹', text: 'ç°åœ¨è½®åˆ°ä½ ä»¬äº†ï¼' },
                { user: 'è§‚ä¼—', text: 'æœ€åçš„æœºä¼šï¼' }
            ],
            èµµå¥å¿æ‚”: [
                { user: 'ç½‘å‹', text: 'èµµå¥ç¬¬ä¸€ä¸ªå´©æºƒäº†ï¼' },
                { user: 'ä½“è‚²ç”Ÿ', text: 'è‚Œè‚‰ç”·å“­å¾—åƒå­©å­ä¸€æ ·' },
                { user: 'å‰éœ¸å‡Œè€…', text: 'æˆ‘ä¹Ÿæ›¾ç»éœ¸å‡Œè¿‡åˆ«äºº...' }
            ],
            è–‡è–‡å¿æ‚”: [
                { user: 'å¹¿æ’­ç«™æˆå‘˜', text: 'è–‡è–‡å½“æ—¶æ˜¯å¹¿æ’­ç«™çš„' },
                { user: 'ç½‘å‹', text: 'é€ è°£ä¼ è°£æœ€å¯æ€•äº†' },
                { user: 'ç½‘ç»œè­¦å¯Ÿ', text: 'ç½‘ç»œæš´åŠ›å®³æ­»äºº' }
            ],
            ç‹é¹å¿æ‚”: [
                { user: 'æ—è§‚è€…', text: 'ç‹é¹ç£•å¤´äº†ï¼' },
                { user: 'é“å¾·å«å£«', text: 'å½“åˆä¸ºä»€ä¹ˆä¸æ•¢ç«™å‡ºæ¥ï¼Ÿ' },
                { user: 'ç½‘å‹', text: 'æ²‰é»˜å°±æ˜¯å¸®å‡¶ï¼' }
            ],
            æ™šæ™´å¿æ‚”: [
                { user: 'ç­é•¿ç²‰ä¸', text: 'æ™šæ™´ç»ˆäºæ‰¿è®¤äº†ï¼' },
                { user: 'å«‰å¦’è€…', text: 'å› ä¸ºå«‰å¦’è€Œä¼¤å®³åˆ«äºº' },
                { user: 'å¿ƒç†åŒ»ç”Ÿ', text: 'æ‰¿è®¤åˆ«äººçš„ä¼˜ç§€å¾ˆéš¾' }
            ],
            æ™šæ™´è´¨é—®: [
                { user: 'åè½¬å¤§å¸ˆ', text: 'æ™šæ™´å¼€å§‹åå’¬æ²ˆå¢¨è¨€ï¼' },
                { user: 'ç½‘å‹', text: 'æ²ˆå¢¨è¨€ä¹Ÿå‚ä¸äº†éœ¸å‡Œï¼Ÿ' },
                { user: 'ä¾¦æ¢', text: 'å‰§æƒ…åè½¬ï¼' }
            ],
            æ²ˆå¢¨è¨€å¦ç™½: [
                { user: 'è§è¯è€…', text: 'æ²ˆå¢¨è¨€å½“æ—¶åœ¨ç°åœºï¼' },
                { user: 'æ‚”æ¨è€…', text: 'ä»–åæ‚”äº†ä¸ƒå¹´ï¼' },
                { user: 'ç½‘å‹', text: 'ä¸€ä¸ªæ‚”æ¨çš„æ—è§‚è€…' }
            ],
            ä¸ƒå¹´å¸ƒå±€: [
                { user: 'ç­–åˆ’å¤§å¸ˆ', text: 'ä¸ƒå¹´å¸ƒå±€ï¼Œåªä¸ºè¿™ä¸€åˆ»ï¼' },
                { user: 'æ³•å­¦å®¶', text: 'æ³•å¾‹æ— æ³•å®¡åˆ¤å†·æš´åŠ›' },
                { user: 'å“²å­¦å®¶', text: 'èˆ†è®ºé—å¿˜ï¼Œä½†è‰¯å¿ƒä¸ä¼š' }
            ],
            äº¤å‡ºé’¥åŒ™: [
                { user: 'è§£è„±è€…', text: 'æ²ˆå¢¨è¨€è¦å»è‡ªé¦–äº†ï¼' },
                { user: 'ç½‘å‹', text: 'ç”µç½‘å…³äº†ï¼Œå¯ä»¥èµ°äº†' },
                { user: 'é¢„è¨€å®¶', text: 'ä½†ç”Ÿæ´»å›ä¸å»äº†' }
            ],
            æœ€åè­¦å‘Š: [
                { user: 'å¿ƒç†å­¦å®¶', text: 'å¿ƒç†å®¡åˆ¤æ¯”æ³•å¾‹æ›´å¯æ€•' },
                { user: 'ç½‘å‹', text: 'æ¯ä¸ªå¤œæ™šéƒ½ä¼šå¬åˆ°å¥¹çš„å“­å£°' },
                { user: 'å“²å­¦å®¶', text: 'æ°¸ä¸è½å¹•çš„è‡ªæˆ‘å®¡åˆ¤' }
            ],
            æ²ˆå¢¨è¨€è·³ä¸‹: [
                { user: 'è§‚ä¼—', text: 'æ²ˆå¢¨è¨€è·³ä¸‹å»äº†ï¼' },
                { user: 'å®‰å…¨å‘˜', text: 'ä»–æ‰£äº†å®‰å…¨é”' },
                { user: 'ç½‘å‹', text: 'ä»–åªæ˜¯å»è‡ªé¦–' }
            ],
            æœ€åç»“å±€: [
                { user: 'é»æ˜è§è¯è€…', text: 'å¤©äº®äº†...' },
                { user: 'ç½‘å‹', text: 'è­¦è½¦æ¥äº†ï¼' },
                { user: 'å“²å­¦å®¶', text: 'å™©æ¢¦æ‰åˆšåˆšå¼€å§‹' },
                { user: 'è§‚ä¼—', text: 'æœ‰äº›ç½ªï¼Œä¸€æ—¦ç›´è§†ï¼Œå°±å†ä¹Ÿæ— æ³•å¿˜è®°äº†' }
            ]
        };
        
        // ==================== å¯¹è¯åºåˆ— ====================
        const dialogues = [
            {
                type: 'narration',
                content: 'åˆå¤œæœ€æ·±å¤„ï¼Œ0ç‚¹æ‚„ç„¶è€Œè‡³ï¼Œæ­£æ˜¯ä¸€å¤œä¸­æœ€é»‘æš—å¯’å†·çš„æ—¶åˆ»ã€‚',
                commentKey: 'åˆå¤œé™ä¸´'
            },
            {
                type: 'narration',
                content: 'æ²ˆé»˜è¨€ç«™åœ¨å¤©å°è¾¹ç¼˜é™„è¿‘ï¼Œé‚£é‡Œç”¨ç²‰ç¬”ç”»ç€ä¸€ä¸ªç²—ç³™çš„äººå½¢è½®å»“â€”â€”è‹ç­±èŠ·å è½åçš„ä½ç½®ã€‚æ—è¾¹ï¼Œä¸çŸ¥é“ä½•æ—¶æ•´æ•´é½é½åœ°æ‘†æ”¾ç€ä½ ä»¬å¾ˆä¸é™Œç”Ÿçš„å››æ ·ä¸œè¥¿ï¼š<br><br>' +
                        'ä½ å½“å¹´å‚åŠ å„ç±»æ¯”èµ›çš„è·å¥–å¥–çŠ¶ï¼›<br>' +
                        'èµµå¥é«˜ä¸­æ—¶æœ€å®è´çš„ã€ç­¾æœ‰çƒæ˜Ÿåå­—çš„ç¯®çƒç…§ç‰‡ã€‚<br>' +
                        'å­™è–‡è–‡ç¬¬ä¸€æ¬¡åœ¨å¹¿æ’­ç«™æ’­éŸ³çš„å½•éŸ³ç£å¸¦å¤–å£³ã€‚<br>' +
                        'ç‹é¹çè—çš„ã€ä»–æ¯äº²é€ä»–çš„æ—§æ¬¾é’¢ç¬”ã€‚',
                commentKey: 'å››äººçç‰©'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"è¿™äº›ï¼Œ"æ²ˆå¢¨è¨€çš„å£°éŸ³åœ¨é£ä¸­æ˜¾å¾—ç©ºæ—·ï¼Œ"æ˜¯ä½ ä»¬å½“å¹´æœ€çè§†ã€æœ€èƒ½ä»£è¡¨ä½ ä»¬å…‰èŠ’å’Œä»·å€¼çš„ä¸œè¥¿ã€‚è€Œè‹ç­±èŠ·æœ€çè§†çš„ï¼Œæ˜¯å¥¹å¯¹ä¸–ç•Œçš„å–„æ„ã€å¥¹çš„æ‰åã€å¥¹çš„çº¸é£æœºâ€¦â€¦è¿˜æœ‰ï¼Œ"ä»–é¡¿äº†é¡¿ï¼Œ"å¥¹å¯¹æœ‹å‹å’Œè®¤å¯é‚£ä¸€ç‚¹ç‚¹å‘å¾®çš„æ¸´æœ›ã€‚"',
                avatar: 'res/æ²ˆå¢¨è¨€.png',
                commentKey: 'è‹ç­±èŠ·çå®'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"ä½ ä»¬è½»æ˜“åœ°è·µè¸äº†å¥¹çš„çå®ã€‚"ä»–çœ‹å‘ä½ ä»¬ï¼Œ"é‚£ä¹ˆç°åœ¨ï¼Œè½®åˆ°ä½ ä»¬äº†ã€‚"',
                avatar: 'res/æ²ˆå¢¨è¨€.png'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"æœ€åçš„æœºä¼šã€‚"æ²ˆå¢¨è¨€çš„ç›®å…‰æ‰«è¿‡ä½ ä»¬å››äººï¼Œ"è¯´å‡ºä½ ä»¬ä»Šæ™šï¼Œåœ¨èµ°å®Œå¥¹èµ°è¿‡çš„è·¯ã€çœ‹è¿‡å¥¹ç•™ä¸‹çš„ç—•è¿¹ã€å¬è¿‡å¥¹æœ€åçš„å“­å£°ä¹‹åâ€¦â€¦æƒ³è¯´çš„è¯ã€‚ä¸æ˜¯å¯¹æˆ‘ï¼Œæ˜¯å¯¹å¥¹ã€‚"',
                avatar: 'res/æ²ˆå¢¨è¨€.png',
                commentKey: 'æ²ˆå¢¨è¨€è´¨é—®'
            },
            {
                type: 'narration',
                content: 'ä»–æŒ‡äº†æŒ‡é‚£ä¸ªç²‰ç¬”è½®å»“ã€‚<br>"å¯¹ç€é‚£é‡Œè¯´ã€‚"<br>é£å‘¼å•¸ç€ï¼Œåƒæ— æ•°å†¤é­‚åœ¨å‘œå’½ã€‚'
            },
            {
                type: 'character',
                character: 'èµµå¥',
                text: 'èµµå¥ç¬¬ä¸€ä¸ªå´©æºƒã€‚è¿™ä¸ªè‚Œè‚‰è™¬ç»“çš„ç”·äººï¼Œæ­¤åˆ»åƒå­©å­ä¸€æ ·ç—›å“­æµæ¶•ï¼Œå¯¹ç€é‚£ä¸ªè½®å»“è¯­æ— ä¼¦æ¬¡ï¼š<br><br>' +
                        '"æˆ‘é”™äº†â€¦â€¦è‹ç­±èŠ·åŒå­¦â€¦â€¦æˆ‘å°±æ˜¯ä¸ªæ··è›‹â€¦â€¦æˆ‘æ²¡æƒ³çœŸè®©ä½ æ­»â€¦â€¦æˆ‘ä¸åº”è¯¥çœ‹ç€æ¬ºè´Ÿä½ å¥½ç©å°±éœ¸å‡Œä½ â€¦â€¦"',
                avatar: 'res/èµµå¥2.png',
                commentKey: 'èµµå¥å¿æ‚”'
            },
            {
                type: 'character',
                character: 'å­™è–‡è–‡',
                text: 'å­™è–‡è–‡è·ªè¶´åœ¨åœ°ä¸Šï¼Œå¦†å®¹ç³Šæˆä¸€å›¢ï¼Œå¯¹ç€åœ°é¢ä¸åœé‡å¤ï¼š<br><br>' +
                        '"å¯¹ä¸èµ·å¯¹ä¸èµ·å¯¹ä¸èµ·â€¦â€¦æˆ‘ä¸è¯¥ä¹±è¯´è¯çš„â€¦â€¦æˆ‘ä¸åº”è¯¥å—äººæŒ‡ä½¿å»é€ è°£â€¦â€¦"',
                avatar: 'res/å­™è–‡è–‡2.png',
                commentKey: 'è–‡è–‡å¿æ‚”'
            },
            {
                type: 'character',
                character: 'ç‹é¹',
                text: 'ç‹é¹è·ªäº†ä¸‹æ¥ï¼Œæœç€è½®å»“é‡é‡ç£•äº†ä¸€ä¸ªå¤´ï¼Œé¢å¤´æŠµç€å†°å†·çš„æ°´æ³¥åœ°ï¼Œåªæœ‰å‹æŠ‘åˆ°æè‡´çš„ã€ç ´ç¢çš„å“½å’½ï¼š<br><br>' +
                        '"æˆ‘åº”è¯¥åœ¨ä½ è¢«é€ è°£è¢«è¾±éª‚çš„æ—¶å€™å‹‡æ•¢ç«™å‡ºæ¥ï¼Œå¦‚æœæˆ‘å½“æ—¶ç«™å‡ºæ¥å°±å¥½äº†â€¦â€¦å‘œå‘œå‘œâ€¦â€¦"',
                avatar: 'res/ç‹é¹2.png',
                commentKey: 'ç‹é¹å¿æ‚”'
            },
            {
                type: 'narration',
                content: 'è½®åˆ°ä½ äº†ï¼Œæ—æ™šæ™´ã€‚<br>ä½ æ„Ÿè§‰æ‰€æœ‰çš„äººè§†çº¿éƒ½é›†ä¸­åœ¨ä½ èº«ä¸Šã€‚'
            },
            {
                type: 'narration',
                content: 'ä½ çœ‹ç€é‚£ä¸ªç²‰ç¬”è½®å»“ï¼Œä»¿ä½›èƒ½çœ‹åˆ°ä¸ƒå¹´å‰é‚£ä¸ªå•è–„çš„å¥³å­©èººåœ¨é‚£é‡Œã€‚ä½ æƒ³èµ·å¥¹å­¦ç±å¡ä¸Šå¹²å‡€çš„ç¬‘å®¹ï¼Œæƒ³èµ·å¥¹æ—¥è®°é‡Œå¯¹ä½ ä»¬æ¯ä¸ªäººçš„ç»†è…»è§‚å¯Ÿå’Œå–„æ„ï¼Œæƒ³èµ·ä½ å¯¹å¥¹è¯´çš„é‚£äº›å†°å†·çš„è¯ã€‚<br><br>' +
                        'è¿Ÿæ¥çš„æ‚”æ¨æ·¹æ²¡äº†ä½ ã€‚'
            },
            {
                type: 'character',
                character: 'æ—æ™šæ™´',
                text: '"è‹ç­±èŠ·â€¦â€¦"ä½ çš„å£°éŸ³å˜¶å“‘ã€‚<br>' +
                      '"å¯¹ä¸èµ·â€¦â€¦ä½ å¤ªä¼˜ç§€äº†â€¦â€¦ä½ ä¸€æ¥å°±æŠ¢èµ°å±äºæˆ‘çš„ç›®å…‰ã€‚æ‰€ä»¥æˆ‘é»˜è®¸ã€ç”šè‡³æ¨åŠ¨äº†é‚£äº›é’ˆå¯¹ä½ çš„æ¶æ„ã€‚<br>' +
                      '"æˆ‘çœ‹åˆ°äº†ä½ çš„ç—›è‹¦ï¼Œä½†æˆ‘é€‰æ‹©äº†æ— è§†ã€‚å› ä¸ºæ‰¿è®¤ä½ çš„ç—›è‹¦ï¼Œå°±ç­‰äºæ‰¿è®¤æˆ‘çš„ä¸‘é™‹ã€‚"<br>' +
                      '"å¯¹ä¸èµ·â€¦â€¦æˆ‘çŸ¥é“è¯´ä»€ä¹ˆéƒ½æ²¡ç”¨äº†â€¦â€¦ä½†æ˜¯å¯¹ä¸èµ·â€¦â€¦"',
                avatar: 'res/æ—æ™šæ™´2.png',
                commentKey: 'æ™šæ™´å¿æ‚”'
            },
            {
                type: 'narration',
                content: 'ä½ è¯´å®Œäº†ã€‚å¤©å°ä¸Šåªå‰©ä¸‹é£å£°å’Œå‹æŠ‘çš„å“­æ³£ã€‚'
            },
            {
                type: 'narration',
                content: 'è€Œåä½ æ­‡æ–¯åº•é‡Œèµ·æ¥ï¼Œç ´ç½å­ç ´æ‘”ä¼¼çš„å†²æ²ˆé»˜è¨€å¼é“ï¼š'
            },
            {
                type: 'character',
                character: 'æ—æ™šæ™´',
                text: '"æ²ˆé»˜è¨€ï¼ä½ åˆ°åº•æ‰®æ¼”çš„æ˜¯ä»€ä¹ˆæ ·çš„è§’è‰²ï¼ä½ å’Œå¥¹çš„å…³ç³»ä¸æ˜¯æœ€å¥½çš„å—ï¼å½“åˆéœ¸å‡Œå¥¹çš„äº‹åˆ«å¿˜äº†ä½ ä¹Ÿå‚ä¸äº†ï¼"',
                avatar: 'res/æ—æ™šæ™´2.png',
                commentKey: 'æ™šæ™´è´¨é—®'
            },
            {
                type: 'narration',
                content: 'æ²ˆé»˜è¨€é™é™åœ°å¬ç€ï¼Œçœ‹ç€ã€‚è‰¯ä¹…ï¼Œä»–æ‰å¼€å£ï¼Œå£°éŸ³é‡Œå¸¦ç€ä¸æ˜“å¯Ÿè§‰çš„é‡Šæ€€ï¼š'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"æ˜¯å•Šï¼Œç”šè‡³å½“æ—¶å¥¹è·³ä¸‹å»çš„æ—¶å€™ï¼Œæˆ‘å°±åœ¨ç°åœºâ€¦â€¦"',
                avatar: 'res/æ²ˆå¢¨è¨€.png'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"ä¸ƒå¹´å‰ï¼Œæˆ‘å°±åœ¨è¿™é‡Œï¼Œçœ¼çççœ‹ç€å¥¹è·³ä¸‹å»ï¼Œå´ä»€ä¹ˆä¹ŸæŠ“ä¸ä½ã€‚é‚£ä¸€åˆ»æˆ‘å°±å‘èª“ï¼Œæˆ‘è¦è®©æ‰€æœ‰ä¼¤å®³è¿‡å¥¹çš„äººï¼Œæ°¸è¿œè®°ä½è¿™ä¸€åˆ»ã€‚<br>' +
                      'ä½ è¯´çš„å¯¹ï¼Œæˆ‘ä¹Ÿæ˜¯å‡¶æ‰‹ä¹‹ä¸€ï¼Œæ²¡æœ‰ç»è¿‡è€ƒè¯å°±åå¬åä¿¡äº†é‚£äº›è°£è¨€ï¼Œç–è¿œäº†å¥¹ã€‚<br>' +
                      'æˆ‘å¥½åæ‚”â€¦â€¦å¥¹æ­»åçš„æ—¥å­é‡Œæˆ‘æ²¡æœ‰ä¸€ä¸ªæ—¶åˆ»æ˜¯ä¸åæ‚”çš„ï¼<br>' +
                      'å¦‚æœæˆ‘é‚£æ—¶å€™ç»™å¥¹é¼“åŠ±ï¼ç»™å¥¹æ”¯æŒï¼ç»“å±€ä¼šä¸ä¼šå°±ä¼šä¸ä¸€æ ·â€¦â€¦<br>' +
                      'å¯æƒœï¼Œä¸–é—´æ²¡æœ‰é‚£ä¹ˆå¤š\'å¦‚æœ\'ã€‚"',
                avatar: 'res/æ²ˆå¢¨è¨€.png',
                commentKey: 'æ²ˆå¢¨è¨€å¦ç™½'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"æ³•å¾‹æ— æ³•å®¡åˆ¤å†·æš´åŠ›ï¼Œèˆ†è®ºå¾ˆå¿«ä¼šé—å¿˜æ—§é—»ï¼Œç”šè‡³ä½ ä»¬è‡ªå·±ï¼Œä¹Ÿä¼šç”¨\'å¹´å°‘æ— çŸ¥\'æ¥å®‰æ…°è‡ªå·±ï¼Œç»§ç»­ä½ ä»¬å…‰é²œäº®ä¸½çš„äººç”Ÿã€‚<br>' +
                      'æ‰€ä»¥ï¼Œæˆ‘ç”¨äº†ä¸ƒå¹´ï¼Œå¸ƒç½®äº†è¿™ä¸€åˆ‡ã€‚æˆ‘è¦ä½ ä»¬äº²è‡ªä½“éªŒè¢«ææƒ§è¿½é€ã€è¢«çœŸç›¸é€¼åˆ°ç»å¢ƒçš„æ„Ÿè§‰ã€‚æˆ‘è¦åœ¨å‡ ç™¾ä¸‡äººé¢å‰ï¼Œå‰¥ä¸‹ä½ ä»¬å…‰é²œçš„å¤–å£³ï¼ŒæŠŠé‡Œé¢æœ€ä¸å ªçš„ä¸œè¥¿ï¼Œæ™’åœ¨å¤ªé˜³åº•ï¼"',
                avatar: 'res/æ²ˆå¢¨è¨€.png',
                commentKey: 'ä¸ƒå¹´å¸ƒå±€'
            },
            {
                type: 'narration',
                content: '"è¿™æŠŠé’¥åŒ™ä½ ä»¬æ‹¿å»å§ï¼Œæˆ‘ä¼šå»è‡ªé¦–ã€‚"ä»–æ‹¿å‡ºæ ¡é—¨é’¥åŒ™ï¼Œæ‰”åœ¨ä½ ä»¬é¢å‰ã€‚'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"ç”µç½‘å·²ç»å…³äº†ã€‚ä½ ä»¬å¯ä»¥èµ°äº†ï¼Œå›åˆ°ä½ ä»¬çš„ç”Ÿæ´»ä¸­å»ï¼Œè‡³äºè¿æ¥ä½ ä»¬çš„ä¼šæ˜¯ä»€ä¹ˆâ€¦â€¦çœ‹å„è‡ªå‘½å§â€¦â€¦"',
                avatar: 'res/æ²ˆå¢¨è¨€.png',
                commentKey: 'äº¤å‡ºé’¥åŒ™'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"ä½†æ˜¯ï¼Œ"ä»–æŒ‡äº†æŒ‡è‡ªå·±çš„è„‘è¢‹ï¼ŒåˆæŒ‡äº†æŒ‡é‚£äº›ä»åœ¨è¿œå¤„æ•™å­¦æ¥¼å¯†å®¤ä¸­è¿è½¬çš„ã€å¯¹ç€è¿™é‡Œçš„æ‘„åƒå¤´ï¼Œ"ä»Šæ™šçš„ä¸€åˆ‡ï¼Œå·²ç»åˆ»åœ¨è¿™é‡Œï¼Œä¹Ÿç•™åœ¨äº†æ— æ•°äººçš„è®°å¿†é‡Œã€‚ä½ ä»¬å¯ä»¥å°è¯•æ´—ç™½ï¼Œå¯ä»¥èµ·è¯‰æˆ‘ï¼Œå¯ä»¥å‡è£…ä¸€åˆ‡éƒ½æ²¡å‘ç”Ÿã€‚"',
                avatar: 'res/æ²ˆå¢¨è¨€.png'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"ä½†ä½ ä»¬è‡ªå·±ä¼šçŸ¥é“ï¼Œä»ä»Šå¾€åï¼Œæ¯ä¸€ä¸ªå¤œæ™šï¼Œä½ ä»¬éƒ½ä¼šå¬åˆ°å¥¹çš„å“­å£°ã€‚æ¯ä¸€æ¬¡æˆåŠŸï¼Œéƒ½ä¼šæƒ³èµ·è¿™ä»½æˆåŠŸä¹‹ä¸‹æ©ç›–çš„ç½ªæ¶ã€‚ä½ ä»¬ç»ˆå…¶ä¸€ç”Ÿï¼Œéƒ½å°†æ´»åœ¨è¿™åœº\'å‰§æœ¬æ€\'çš„ç»­é›†é‡Œâ€”â€”ä¸€åœºæ°¸ä¸è½å¹•çš„ã€è‡ªæˆ‘å®¡åˆ¤çš„ææ€–ç§€ï¼"',
                avatar: 'res/æ²ˆå¢¨è¨€.png'
            },
            {
                type: 'character',
                character: 'æ²ˆå¢¨è¨€',
                text: '"è¿™ä¸æ˜¯æˆ‘å¯¹ä½ ä»¬çš„æŠ¥å¤ï¼Œåªæ˜¯æ›¿å°çº¸å¤ä»‡ç½¢äº†ï¼Œä»¥å®‰æ¯å¥¹ä¸å¾—å®é™çš„æ€¨æ°”ï¼Œä½ ä»¬ç”Ÿä¸å¦‚æ­»çš„æ ·å­å°±ç®—æ˜¯å¯¹è¿™çº¸æ€¨æœ€å¥½çš„å‘Šæ…°ï¼"',
                avatar: 'res/æ²ˆå¢¨è¨€.png',
                commentKey: 'æœ€åè­¦å‘Š'
            },
            {
                type: 'narration',
                content: 'è¯´å®Œï¼Œæ²ˆå¢¨è¨€ä¸å†çœ‹ä½ ä»¬ä»»ä½•äººã€‚ä»–èµ°åˆ°å¤©å°å¦ä¸€è¾¹ï¼Œä»–ç†Ÿç»ƒåœ°æ‰£ä¸Šå®‰å…¨é”ï¼Œæœ€åå›å¤´çœ‹äº†ä¸€çœ¼è¿™ç‰‡æ‰¿è½½äº†å¤ªå¤šç—›è‹¦ä¸ç½ªæ¶çš„å±‹é¡¶ï¼Œç„¶åï¼Œçºµèº«ä¸€è·ƒï¼Œèº«å½±æ¶ˆå¤±åœ¨æœ¦èƒ§çš„å¤œè‰²ä¸æ¸èµ·çš„æ™¨é›¾ä¹‹ä¸­ã€‚<br><br>' +
                        'ä»–èµ°äº†ã€‚',
                commentKey: 'æ²ˆå¢¨è¨€è·³ä¸‹'
            },
            {
                type: 'narration',
                content: 'ç•™ä¸‹ä½ ä»¬å››äººï¼Œç«™åœ¨æ¸æ¸äº®èµ·çš„å¤©å…‰ä¸‹ï¼Œç«™åœ¨é‚£ä¸ªæ— å£°çš„ç²‰ç¬”è½®å»“æ—ï¼Œç«™åœ¨æ»¡åœ°ç‹¼è—‰çš„çœŸç›¸ä¸å‡ ç™¾ä¸‡åŒ"çœ¼ç›"çš„æ³¨è§†ä¹‹ä¸‹ã€‚<br><br>' +
                        'æ ¡é—¨é’¥åŒ™å°±åœ¨è„šè¾¹ã€‚<br>' +
                        'è‡ªç”±è§¦æ‰‹å¯åŠã€‚<br>' +
                        'ä½†ä½ ä»¬éƒ½çŸ¥é“ã€‚'
            },
            {
                type: 'narration',
                content: 'æœ‰äº›é—¨ï¼Œä¸€æ—¦æ‰“å¼€ï¼Œå°±å†ä¹Ÿå…³ä¸ä¸Šäº†ã€‚'
            },
            {
                type: 'narration',
                content: 'æœ‰äº›ç½ªï¼Œä¸€æ—¦ç›´è§†ï¼Œå°±å†ä¹Ÿæ— æ³•å¿˜è®°äº†ã€‚'
            },
            {
                type: 'narration',
                content: 'è¿œå¤„çº¢è“å…‰èŠ’åˆºç ´å¤œæ™šçš„å®é™ï¼Œè­¦ç¬›å£°ç”±è¿œåŠè¿‘ã€‚<br><br>' +
                        'ä½ ä»¬çš„å™©æ¢¦ï¼Œæ‰åˆšåˆšå¼€å§‹ã€‚',
                commentKey: 'æœ€åç»“å±€',
                onComplete: function() {
                    // æ˜¾ç¤ºç« èŠ‚è¿‡æ¸¡åŠ¨ç”»
                    showChapterTransition();
                }
            }
        ];
        
        // ==================== æ ¸å¿ƒå‡½æ•° ====================
        // ç­‰å¾…ç‚¹å‡»ç»§ç»­
        function waitForClick(callback) {
            if (gameState.isWaitingForClick) return;
            
            gameState.isWaitingForClick = true;
            gameState.clickCallback = callback;
        }
        
        // å¤„ç†åœºæ™¯ç‚¹å‡»
        function handleSceneClick(event) {
            // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»äº†éŸ³ä¹æŒ‰é’®æˆ–åœ°å›¾é“¾æ¥
            if (event.target.closest('.music-btn') ||
                event.target.closest('.map-link') ||
                event.target.closest('a[href="news.html"]') ||
                event.target.closest('a[href="index.html"]')) {
                return;
            }
            
            if (gameState.isWaitingForClick && gameState.clickCallback) {
                const callback = gameState.clickCallback;
                gameState.isWaitingForClick = false;
                gameState.clickCallback = null;
                callback();
            }
        }
        
        // ==================== æ˜¾ç¤ºæ–°é—»é¡µé¢é“¾æ¥ ====================
        function showNewsLink() {
            const container = elements.dialogueContainer;
            if (!container) return;
            
            const finalBox = document.createElement('div');
            finalBox.className = 'narration-box';
            
            finalBox.innerHTML = `
                <div class="dialogue-text">
                    <div style="text-align: center; margin: 20px 0;">
                        <a href="news.html" style="color: #4ecdc4; font-size: 18px; font-weight: bold; text-decoration: none; transition: all 0.3s; padding: 5px 10;" 
                        onmouseover="this.style.color='#ffcc00'; this.style.textDecoration='underline';" 
                        onmouseout="this.style.color='#4ecdc4'; this.style.textDecoration='none';">
                        æ–°é—»æ—¥æŠ¥
                        </a>
                    </div>
                    <div style="text-align: center; color: #ff6b6b; font-size: 16px; margin: 10px 0; padding: 10px; background: rgba(0, 0, 0, 0.5); border-radius: 5px;">
                        æ¸¸æˆç»“æŸ<br>
                        æ„Ÿè°¢ä½“éªŒã€Šçº¸æ€¨ã€‹<br><br>
                        <a href="index.html" style="color: #ff6b6b; text-decoration: underline;">ç‚¹å‡»è¿”å›æ¸¸æˆé‡æ–°å¼€å§‹</a>
                    </div>
                </div>
                <div class="dialogue-hint">æç¤ºï¼šç‚¹å‡»æ–°é—»æ—¥æŠ¥æŸ¥çœ‹åç»­æŠ¥é“</div>
            `;
            
            container.innerHTML = '';
            container.appendChild(finalBox);
            
            setTimeout(() => {
                finalBox.style.opacity = '1';
                finalBox.style.animation = 'dialogueFadeIn 0.5s ease';
            }, 10);
        }
        
        // ==================== å¼¹å¹•ç³»ç»Ÿ ====================
        const shownCommentGroups = new Set();
        
        function addCommentsOnce(comments, interval = 500) {
            const commentKey = comments[0]?.text;
            if (shownCommentGroups.has(commentKey)) {
                return;
            }
            shownCommentGroups.add(commentKey);
            
            let index = 0;
            
            function addNextComment() {
                if (index >= comments.length) return;
                
                const comment = comments[index];
                
                const commentDiv = document.createElement('div');
                commentDiv.className = 'comment pop-in';
                commentDiv.innerHTML = `
                    <div class="comment-user">${comment.user}</div>
                    <div>${comment.text}</div>
                `;
                elements.commentArea.appendChild(commentDiv);
                
                setTimeout(() => {
                    commentDiv.style.animation = 'popIn 0.5s ease forwards';
                }, 10);
                
                scrollCommentsToBottom();
                
                const currentCount = parseInt(elements.viewerCount.textContent);
                const increment = Math.floor(Math.random() * 10) + 5;
                elements.viewerCount.textContent = currentCount + increment;
                
                index++;
                
                if (index < comments.length) {
                    setTimeout(addNextComment, interval);
                }
            }
            
            addNextComment();
        }
        
        function scrollCommentsToBottom() {
            if (elements.commentArea) {
                elements.commentArea.scrollTop = elements.commentArea.scrollHeight;
            }
        }
        
        // ==================== äººç‰©ç«‹ç»˜ç®¡ç†ç³»ç»Ÿ ====================
        // æ˜¾ç¤ºäººç‰©ç«‹ç»˜ - æ·»åŠ åŠ¨ç”»æ•ˆæœ
        function showAvatar(character, avatar) {
            // æ¸…é™¤ç°æœ‰ç«‹ç»˜
            if (elements.characterAvatarContainer) {
                elements.characterAvatarContainer.innerHTML = '';
            }
            
            if (!character || !avatar) return;
            
            const charConfig = gameState.characters[character];
            if (!charConfig) return;
            
            const avatarImg = document.createElement('img');
            avatarImg.className = `character-avatar-img ${charConfig.position === 'right' ? 'character-right' : 'character-left'}`;
            avatarImg.src = avatar;
            avatarImg.alt = character;
            avatarImg.style.opacity = '0';
            avatarImg.style.animation = 'avatarFadeIn 0.7s ease forwards';
            
            elements.characterAvatarContainer.appendChild(avatarImg);
            
            // è®¾ç½®æ·¡å…¥åŠ¨ç”»
            setTimeout(() => {
                avatarImg.style.opacity = '1';
            }, 10);
            
            gameState.currentCharacter = character;
            gameState.currentAvatar = avatar;
        }
        
        // æ¸…é™¤äººç‰©ç«‹ç»˜
        function clearAvatar() {
            if (elements.characterAvatarContainer) {
                elements.characterAvatarContainer.innerHTML = '';
            }
            gameState.currentCharacter = null;
            gameState.currentAvatar = null;
        }
        
        // ==================== å¯¹è¯æ’­æ”¾ç³»ç»Ÿ ====================
        function playCurrentDialogue() {
            if (gameState.currentDialogueIndex >= dialogues.length) return;
            
            const dialogue = dialogues[gameState.currentDialogueIndex];
            
            // è§¦å‘å¼¹å¹•
            if (dialogue.commentKey && commentsData[dialogue.commentKey]) {
                addCommentsOnce(commentsData[dialogue.commentKey], 500);
            }
            
            // æ’­æ”¾å¯¹è¯
            if (dialogue.type === 'narration') {
                showNarrationDialogue(dialogue);
            } else if (dialogue.type === 'character') {
                showCharacterDialogue(dialogue);
            }
        }
        
        function showNarrationDialogue(dialogue) {
            // æ¸…é™¤ç«‹ç»˜
            clearAvatar();
            
            const container = elements.dialogueContainer;
            if (!container) return;
            
            const narrationBox = document.createElement('div');
            narrationBox.className = 'narration-box';
            
            narrationBox.innerHTML = `
                <div class="dialogue-text">${dialogue.content}</div>
                <div class="dialogue-hint">æç¤ºï¼šç‚¹å‡»å±å¹•ä»»æ„ä½ç½®ç»§ç»­</div>
            `;
            
            container.innerHTML = '';
            container.appendChild(narrationBox);
            
            setTimeout(() => {
                narrationBox.style.opacity = '1';
                narrationBox.style.animation = 'dialogueFadeIn 0.5s ease';
                
                // ç­‰å¾…ç”¨æˆ·ç‚¹å‡»åç»§ç»­ä¸‹ä¸€æ®µå¯¹è¯
                waitForClick(() => {
                    // å¦‚æœæœ‰å®Œæˆå›è°ƒï¼Œå…ˆæ‰§è¡Œå›è°ƒ
                    if (dialogue.onComplete && typeof dialogue.onComplete === 'function') {
                        dialogue.onComplete();
                    } else {
                        gameState.currentDialogueIndex++;
                        playCurrentDialogue();
                    }
                });
            }, 10);
        }
        
        function showCharacterDialogue(dialogue) {
            // æ˜¾ç¤ºäººç‰©ç«‹ç»˜
            if (dialogue.character && dialogue.avatar) {
                showAvatar(dialogue.character, dialogue.avatar);
            }
            
            const container = elements.dialogueContainer;
            if (!container) return;
            
            const charConfig = gameState.characters[dialogue.character];
            const dialogueBox = document.createElement('div');
            dialogueBox.className = 'dialogue-box';
            dialogueBox.style.animation = 'dialogueFadeIn 0.5s ease';
            
            dialogueBox.innerHTML = `
                <div class="dialogue-title">
                    <span class="title-icon" style="background-color:${charConfig.color}"></span>
                    ${dialogue.character}
                </div>
                <div class="dialogue-text">${dialogue.text}</div>
                <div class="dialogue-hint">æç¤ºï¼šç‚¹å‡»å±å¹•ä»»æ„ä½ç½®ç»§ç»­</div>
            `;
            
            container.innerHTML = '';
            container.appendChild(dialogueBox);
            
            setTimeout(() => {
                dialogueBox.style.opacity = '1';
                
                // ç­‰å¾…ç”¨æˆ·ç‚¹å‡»åç»§ç»­ä¸‹ä¸€æ®µå¯¹è¯
                waitForClick(() => {
                    gameState.currentDialogueIndex++;
                    playCurrentDialogue();
                });
            }, 10);
        }
        
        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ’­æ”¾éŸ³ä¹ï¼ˆå·²åœ¨DOMContentLoadedä¸­å¤„ç†ï¼‰
            
            // æ˜¾ç¤ºåˆå§‹å¼¹å¹•
            setTimeout(() => {
                addCommentsOnce(commentsData.å¤©å°å¼€åœº, 500);
            }, 1000);
            
            // è®¾ç½®å…¨å±€ç‚¹å‡»ç›‘å¬
            document.addEventListener('click', function(e) {
                handleSceneClick(e);
            });
            
            // æ˜¾ç¤ºåˆå§‹æ—ç™½æ¡†
            setTimeout(() => {
                if (elements.narrationBox) {
                    elements.narrationBox.style.opacity = '1';
                    elements.narrationBox.style.animation = 'dialogueFadeIn 0.5s ease';
                }
            }, 100);
            
            // åˆå§‹åŒ–ç­‰å¾…ç‚¹å‡»å¼€å§‹å¯¹è¯
            waitForClick(() => {
                gameState.currentDialogueIndex = 0;
                playCurrentDialogue();
            });
            
            scrollCommentsToBottom();
        });
    </script>
</body>
</html>