<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¸æ€¨ - ç›´æ’­å¼€åœº</title>
    <style>
        /* é‡ç½®æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
        }
        
        /* ç« èŠ‚è¿‡æ¸¡åŠ¨ç”» - ä¼˜å…ˆçº§æœ€é«˜ */
        .chapter-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 1;
            pointer-events: auto;
        }
        
        .chapter-transition.hide {
            display: none;
            opacity: 0;
            pointer-events: none;
        }
        
        .chapter-text {
            font-family: "Blackletter", "Old English Text MT", "Gothic", serif;
            font-size: 48px;
            color: #8b0000;
            text-align: center;
            opacity: 0;
            text-shadow: 
                0 0 5px #8b0000,
                0 0 10px #8b0000,
                0 0 15px #600000,
                0 0 20px #400000;
            letter-spacing: 3px;
            line-height: 1.3;
            padding: 0 20px;
            transform: scale(0.9);
        }
        
        /* å­—ä½“å›é€€æ–¹æ¡ˆ */
        @import url('https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap');
        
        .chapter-text {
            font-family: 'UnifrakturMaguntia', "Old English Text MT", "Gothic", serif;
        }

        /* ç”µè„‘å±å¹•èƒŒæ™¯ - æš—è‰²è°ƒæˆ¿é—´ */
        .room-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            z-index: 1;
        }

        /* æ¸¸æˆæ ‡é¢˜ */
        .game-title {
            position: absolute;
            top: 30px;
            left: 0;
            width: 100%;
            text-align: center;
            color: #ff6b6b;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
            letter-spacing: 2px;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .game-title.show {
            opacity: 1;
        }

        /* æŸ¥çœ‹åœ°å›¾æŒ‰é’®æ ·å¼ - å›ºå®šåœ¨å·¦ä¸Šè§’ï¼Œæé«˜å±‚çº§ */
        .map-link {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: #fff;
            border: 2px solid #ff6b6b;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            z-index: 999;
            display: none;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .map-link.show {
            display: inline-block;
        }

        .map-link:hover {
            background-color: rgba(255, 107, 107, 0.3);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }

        /* æ•´ä¸ªæ‰‹æœºç•Œé¢ */
        .game-container {
            width: 350px;
            height: 700px;
            background: #111;
            border-radius: 40px;
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.3);
            padding: 15px;
            overflow: hidden;
            position: relative;
            z-index: 10;
            margin-top: -30px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .game-container.show {
            opacity: 1;
        }

        /* æ‰‹æœºå±å¹•å†…å®¹ */
        .phone-screen {
            width: 100%;
            height: 100%;
            background: #000;
            border-radius: 30px;
            overflow: hidden;
            position: relative;
        }

        /* çŠ¶æ€æ  */
        .status-bar {
            height: 25px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        .time { font-weight: bold; }
        .battery { color: #4cd964; }
        .battery::after {
            content: "âš¡";
            margin-left: 4px;
        }

        /* ç›´æ’­å‡†å¤‡ç•Œé¢ */
        .live-prepare {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }

        .live-prepare-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #ff6b6b;
            margin-bottom: 20px;
            object-fit: cover;
        }

        .live-prepare-id {
            color: #ff6b6b;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .live-prepare-title {
            color: #fff;
            font-size: 16px;
            text-align: center;
            line-height: 1.5;
            margin-bottom: 40px;
            padding: 0 10px;
        }

        .start-live-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff4757 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
            transition: all 0.3s ease;
        }

        .start-live-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 71, 87, 0.6);
        }

        .start-live-btn:active {
            transform: translateY(1px);
        }

        /* ç›´æ’­ä¸»å†…å®¹åŒº */
        .live-content {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.8s ease-in;
        }
        .live-content.show {
            opacity: 1;
        }

        /* ç›´æ’­æ‘„åƒå¤´ç”»é¢ - æ—æ™šæ™´çš„è„¸ */
        .live-camera-view {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 5;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        /* ä¸»æ’­å¤´åƒï¼ˆæ‘„åƒå¤´ç”»é¢ä¸­çš„æ—æ™šæ™´ï¼‰ */
        .live-camera-view img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center 30%;
        }

        /* ç›´æ’­ä¿¡æ¯è¦†ç›–å±‚ */
        .live-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        /* ä¸»æ’­ä¿¡æ¯ï¼ˆå·¦ä¸Šè§’ï¼‰ */
        .host-info-overlay {
            position: absolute;
            top: 30px;
            left: 15px;
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .host-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid #ff6b6b;
            margin-right: 10px;
            object-fit: cover;
        }

        .host-name {
            color: #ff6b6b;
            font-size: 14px;
            font-weight: bold;
        }

        /* å¼¹å¹•åŒºåŸŸ */
        .danmu-area {
            position: absolute;
            top: 80px;
            left: 15px;
            width: 70%;
            height: 60%;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 10px;
            display: flex;
            flex-direction: column-reverse;
            z-index: 15;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 107, 107, 0.3) transparent;
        }

        .danmu-area::-webkit-scrollbar {
            width: 6px;
        }

        .danmu-area::-webkit-scrollbar-track {
            background: transparent;
        }

        .danmu-area::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 107, 0.5);
            border-radius: 3px;
        }

        /* å¼¹å¹•æ ·å¼ - ç»Ÿä¸€é»‘è‰²èƒŒæ™¯ */
        .danmu {
            color: white;
            font-size: 14px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            word-break: break-word;
            line-height: 1.4;
            transition: opacity 0.3s;
            max-width: 90%;
            align-self: flex-start;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .danmu.fading {
            opacity: 0.3;
        }

        /* NEWå¼¹å¹•æç¤º */
        .new-danmu-indicator {
            position: absolute;
            top: 70px;
            right: 15px;
            background: rgba(255, 107, 107, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            z-index: 20;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s;
            pointer-events: auto;
        }

        .new-danmu-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* åœ¨çº¿äººæ•°æ˜¾ç¤º */
        .viewer-count {
            position: absolute;
            top: 30px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: #ff6b6b;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 20;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        /* åº•éƒ¨æ–‡æœ¬æ¡†æ ·å¼ï¼ˆå‚è€ƒgate.htmlï¼‰ */
        .bottom-dialog-box {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px;
            border-top: 2px solid #8B0000;
            z-index: 20;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .bottom-dialog-box.show {
            opacity: 1;
        }
        .bottom-dialog-header {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #DC143C;
            font-weight: bold;
        }

        .bottom-dialog-header .mic-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #DC143C;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
        }

        .bottom-dialog-text {
            color: #FFF8DC;
            line-height: 1.6;
            font-size: 16px;
            padding: 5px 0;
        }

        /* ç»§ç»­æç¤º */
        .continue-hint {
            color: #FFD700;
            font-size: 14px;
            text-align: center;
            margin-top: 5px;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* ç‚¹å‡»åŒºåŸŸ */
        .click-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 15;
            cursor: pointer;
            pointer-events: none;
        }
        .click-area.active {
            pointer-events: auto;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>
    <!-- æ·»åŠ éŸ³é¢‘å…ƒç´  -->
    <audio id="bgm-audio" loop>
        <source src="res/ç›´æ’­éŸ³é¢‘.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
    </audio>
    
    <div class="room-background"></div>
    <div class="chapter-transition" id="chapter-transition">
        <div class="chapter-text" id="chapter-text">å†è§äº†ï¼Œæˆ‘çš„è€åŒå­¦ä»¬</div>
    </div>
    <div class="game-title" id="game-title">çº¸æ€¨ - ç›´æ’­å¼€åœº</div>
    <a href="map.html" class="map-link" id="map-link">æŸ¥çœ‹åœ°å›¾</a>
    <div class="game-container" id="game-container">
        <div class="phone-screen">
            <div class="status-bar">
                <div class="time">19:43</div>
                <div class="network">5G</div>
                <div class="battery">87%</div>
            </div>
            <div class="live-prepare" id="live-prepare">
                <img src="res/æ—æ™šæ™´.png" alt="æ—æ™šæ™´" class="live-prepare-avatar">
                <div class="live-prepare-id">æ™šæ™´ä¸æ™š</div>
                <div class="live-prepare-title">ã€é‡è¿”é«˜ä¸­æ¯æ ¡ï¼çœŸäººææ€–å‰§æœ¬æ€ã€‘</div>
                <button class="start-live-btn" id="start-live-btn">å¼€å§‹ç›´æ’­</button>
            </div>
            <div class="live-content" id="live-content">
                <div class="live-camera-view">
                    <img src="res/æ—æ™šæ™´.png" alt="æ—æ™šæ™´ç›´æ’­" id="live-face">
                </div>
                <div class="live-overlay">
                    <div class="host-info-overlay">
                        <img src="res/æ—æ™šæ™´.png" alt="æ—æ™šæ™´" class="host-avatar">
                        <div class="host-name">æ™šæ™´ä¸æ™š</div>
                    </div>
                    <div class="danmu-area" id="danmu-container"></div>
                    <div class="new-danmu-indicator" id="new-danmu-indicator">
                        æ–°å¼¹å¹• <span id="new-count">0</span>+
                    </div>
                    <div class="viewer-count">åœ¨çº¿ï¼š<span id="viewer-num">8,214</span>äºº</div>
                </div>
            </div>
        </div>
    </div>
    <div class="bottom-dialog-box" id="bottom-dialog">
        <div class="bottom-dialog-header">
            <span class="mic-icon">ğŸ¤</span>
            æ—æ™šæ™´
        </div>
        <div class="bottom-dialog-text" id="dialog-content"></div>
        <div class="continue-hint">ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®ç»§ç»­</div>
    </div>
    <div class="click-area" id="click-area"></div>

    <script>
        // æ•°æ®é…ç½®
        const liveData = {
            randomDanmuPool: [
                "æ™šæ™šè€å©†æˆ‘æ¥å•¦~", "ä¸»æ’­æ™šä¸Šå¥½", "æ™šæ™šä»Šå¤©å¥½ç¾ï¼", "è¿™æ˜¯ä»€ä¹ˆç›´æ’­ï¼Ÿ", "ææ€–å‰§æœ¬æ€ï¼Ÿåˆºæ¿€ï¼", 
                "æ™šæ™šå¥½å¯çˆ±", "å…³æ³¨äº†å…³æ³¨äº†", "ç¤¼ç‰©èµ°ä¸€æ³¢", "èƒŒæ™¯å¥½æš—å•Š", "ä¸»æ’­åœ¨å“ªé‡Œï¼Ÿ", 
                "è¿™ä¸ªæ ¡é—¨æœ‰ç‚¹çœ¼ç†Ÿ", "å®³æ€•ä½†åˆæƒ³çœ‹", "æ™šæ™šå£°éŸ³å¥½å¥½å¬", "æ”¯æŒæ™šæ™šï¼", "å‰§æœ¬æ€å¼€å§‹äº†å—ï¼Ÿ", 
                "åœ¨çº¿äººæ•°å¥½å¤š", "æ–°æ¥çš„æ±‚ç§‘æ™®", "è¿™ä¸ªå¸ƒæ™¯å¥½çœŸå®", "æ™šæ™šåŠ æ²¹ï¼", "æœŸå¾…åç»­", 
                "ä¸æ•¢çœ‹ä½†æƒ³çœ‹", "æ™šæ™šæœ€ç¾ï¼", "è¿™ä¸ªç›´æ’­æœ‰æ„æ€", "ç»§ç»­ç»§ç»­", "å…³æ³¨ç‚¹èµ·æ¥"
            ],
            dialogues: [
                {
                    host: "å®å®ä»¬æ™šä¸Šå¥½ï¼ä»Šæ™šä¸Šç»™å¤§å®¶æ¥ä¸ªç‰¹åˆ«ç›´æ’­ï¼çŒœçŒœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ",
                    danmus: ["æ™šæ™šè€å©†æˆ‘æ¥å•¦~", "ä¸»æ’­æ™šä¸Šå¥½ï¼Œæ™šæ™šä»Šå¤©å¥½ç¾ï¼", "æ™šæ™šå‘¨å›´å¥½é»‘å•Šï¼Œè¿™æ˜¯åœ¨å“ªï¼Ÿ"]
                },
                {
                    host: "å¥½å•¦~ä¸å–å…³å­äº†ï¼Œä»Šå¤©æ™šæ™šè¦å¸¦ä½ ä»¬å›åˆ°æˆ‘çš„é«˜ä¸­æ¯æ ¡ã€‚æ®è¯´è¿™é‡Œä¸ƒå¹´å‰æœ‰ä¸ªå¥³ç”Ÿè·³æ¥¼ï¼Œä¸€ç›´åœ¨é—¹é¬¼ï¼Œå®³çš„æˆ‘ä»¬æ¯æ ¡åªèƒ½æ¬èµ°ï¼Œæ˜å¤©å°±è¦æ‹†è¿äº†ã€‚",
                    danmus: ["ç›´æ’­æ ‡é¢˜æš´éœ²äº†ä½ ï¼ˆdogeï¼‰", "å“‡å¡ï¼çœŸäººææ€–å‰§æœ¬æ€ï¼è¿™ä¹ˆåˆºæ¿€ï¼Ÿï¼"]
                },
                {
                    host: "è°¢è°¢å¤§å®¶é€çš„ç¤¼ç‰©~ä¸è¿‡å¤§å®¶åˆ«å®³æ€•ï¼Œä»Šæ™šæˆ‘ä»¬æœ‰äº”ä½è€åŒå­¦èšåœ¨ä¸€èµ·ï¼Œèª“è¦æªå‡ºæ˜¯è°åœ¨è£…ç¥å¼„é¬¼ï¼å‡¶æ‰‹å°±åœ¨æˆ‘ä»¬å½“ä¸­å“¦~åˆšè¿›ç›´æ’­é—´çš„å®å®ä»¬è®°å¾—ç»™æ™šæ™šç‚¹ç‚¹å…³æ³¨~çœ‹ä¸»æ’­å¸¦ä½ ä»¬æŠ“å‡ºå‡¶æ‰‹ï¼",
                    danmus: ["çœŸçš„å‡çš„å•Šï¼Ÿå¤§æ‰‹ç¬”å•Šï¼Œä¸ºäº†è¿™ä¸ªå‰§æœ¬æ€è¿˜ç‰¹æ„æ‰¾äº†åœºåœ°å—ï¼Ÿ", "å·²ç»å¼€å§‹äº†å—ï¼Ÿè¿™ä¹ˆæ²‰æµ¸å—ï¼Ÿ", "åˆšæ¥ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿæ™šæ™šè¦æ”¹è¡Œäº†ï¼Ÿæˆ‘è¿˜æƒ³çœ‹ä¸»æ’­è¾£èˆæ¥ç€ï¼ˆå¯æƒœï¼‰", "ä»Šå¤©å±…ç„¶æ˜¯ææ€–partï¼ŸæœŸå¾…ä½äº†", "å°±æ™šæ™šä¸€ä¸ªäººå—ï¼Ÿè¿˜æœ‰è°å•Šï¼Ÿ", "å¿«è¿›åˆ°ä¸»æ’­è¢«å“å“­ï¼", "èƒ†å°äººå£«ä¸æ•¢çœ‹äº†", "æ™šæ™šåˆ«æ€•ï¼Œæ€•çš„è¯èº²æˆ‘æ€€é‡Œï¼ˆçŒ¥çç¬‘ï¼‰", "ä¸ä¼šæ˜¯æ¥æå™±å¤´å§"],
                    isLast: true 
                }
            ]
        };

        // å…¨å±€çŠ¶æ€ç®¡ç†
        let state = {
            currentDialogIndex: 0, 
            viewerCount: 8214,
            isLiveComplete: false,
            newDanmuCount: 0,
            isScrollingDanmu: false,
            isLiveStarted: false,
            danmuInterval: null,
            isTransitioning: true,
            bgmPlayed: false // æ–°å¢ï¼šæ ‡è®°BGMæ˜¯å¦å·²æ’­æ”¾
        };

        // å…¨å±€jQueryé€‰æ‹©å™¨
        const $danmuContainer = $('#danmu-container');
        const $newDanmuIndicator = $('#new-danmu-indicator');
        const $newCount = $('#new-count');
        const $viewerNum = $('#viewer-num');
        const $bottomDialog = $('#bottom-dialog');
        const $dialogContent = $('#dialog-content');
        const $mapLink = $('#map-link');
        const $continueHint = $('.continue-hint');
        const $liveContent = $('#live-content');
        const $livePrepare = $('#live-prepare');
        const $clickArea = $('#click-area');
        const $gameTitle = $('#game-title');
        const $gameContainer = $('#game-container');
        const $chapterTransition = $('#chapter-transition');
        const $chapterText = $('#chapter-text');
        const $bgmAudio = $('#bgm-audio'); // æ–°å¢ï¼šéŸ³é¢‘å…ƒç´ é€‰æ‹©å™¨

        // é¡µé¢åŠ è½½åæ‰§è¡Œ
        $(document).ready(function() {
            initLive();
            showChapterTransition();
        });

        // ç« èŠ‚è¿‡æ¸¡åŠ¨ç”»
        function showChapterTransition() {
            // æ–‡å­—æ¸ç°
            setTimeout(() => {
                $chapterText.css({
                    'opacity': '1',
                    'transform': 'scale(1)',
                    'transition': 'all 1.5s ease-out'
                });
            }, 100);
            
            // 1.5ç§’åæ¸éšï¼Œæ˜¾ç¤ºæ¸¸æˆç•Œé¢
            setTimeout(() => {
                $chapterText.css({
                    'opacity': '0',
                    'transform': 'scale(1.1)',
                    'transition': 'all 1s ease-in'
                });
                
                setTimeout(() => {
                    $chapterTransition.addClass('hide');
                    state.isTransitioning = false;
                    $gameTitle.addClass('show');
                    $gameContainer.addClass('show');
                }, 1000);
            }, 1500);
        }

        // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
        function playBGM() {
            // é˜²æ­¢é‡å¤æ’­æ”¾
            if (state.bgmPlayed) return;
            
            // å¤„ç†æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾ç­–ç•¥
            const audio = $bgmAudio[0];
            audio.volume = 0.7; // è®¾ç½®éŸ³é‡ï¼ˆ0-1ï¼‰
            audio.play().catch(err => {
                console.log('è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:', err);
                // å¤‡ç”¨æ–¹æ¡ˆï¼šç›‘å¬ç¬¬ä¸€æ¬¡ç‚¹å‡»åæ’­æ”¾
                $(document).one('click', () => {
                    audio.play();
                });
            });
            
            state.bgmPlayed = true;
        }

        // å¼€å§‹ç›´æ’­
        function startRealLive() {
            if (state.isLiveStarted || state.isTransitioning) return;
            
            // æ–°å¢ï¼šæ’­æ”¾èƒŒæ™¯éŸ³ä¹
            playBGM();
            
            $livePrepare.css({
                'opacity': '0',
                'transform': 'scale(0.95)',
                'pointer-events': 'none',
                'transition': 'all 0.8s ease-out'
            });
            $liveContent.addClass('show');
            $clickArea.addClass('active');
            state.isLiveStarted = true;
            
            setTimeout(() => {
                $bottomDialog.addClass('show');
            }, 300);
            
            showHostDialog(0);
            simulateFastViewerGrowth();
            
            // å¯åŠ¨éšæœºå¼¹å¹•å®šæ—¶å™¨ - å…¨ç¨‹ä¸åœæ­¢
            state.danmuInterval = setInterval(() => {
                createRandomDanmu();
            }, 800);
        }

        // æ˜¾ç¤ºä¸»æ’­å°è¯å’Œå¯¹åº”å¼¹å¹•
        function showHostDialog(index) {
            if (index >= liveData.dialogues.length) return;
            const current = liveData.dialogues[index];
            $dialogContent.text(current.host);
            
            // åˆ·å¯¹åº”å¼¹å¹•
            current.danmus.forEach((danmu, i) => {
                setTimeout(() => addDanmu(danmu), i * 200);
            });
        }

        // æ·»åŠ å•æ¡å¼¹å¹• - æ ¸å¿ƒå‡½æ•°
        function addDanmu(content) {
            const $danmuElement = $('<div>').addClass('danmu').text(content);
            $danmuContainer.prepend($danmuElement);
            
            // é™åˆ¶å¼¹å¹•æ•°é‡ï¼Œè¶…è¿‡15æ¡è‡ªåŠ¨åˆ é™¤æœ€æ—§çš„
            if ($danmuContainer.children().length > 15) {
                $danmuContainer.children().last().remove();
            }
            
            // æ–°å¼¹å¹•æç¤ºé€»è¾‘
            if (state.isScrollingDanmu) {
                state.newDanmuCount++;
                $newCount.text(state.newDanmuCount);
                $newDanmuIndicator.addClass('show');
            } else {
                $danmuContainer.scrollTop(0);
            }
        }

        // ç”Ÿæˆéšæœºå¼¹å¹•
        function createRandomDanmu() {
            const content = liveData.randomDanmuPool[Math.floor(Math.random() * liveData.randomDanmuPool.length)];
            addDanmu(content);
        }

        // åœ¨çº¿äººæ•°å¢é•¿
        function simulateFastViewerGrowth() {
            const growthInterval = setInterval(() => {
                const growthRate = Math.floor(Math.random() * 2000) + 1000;
                state.viewerCount += growthRate;
                $viewerNum.text(state.viewerCount >= 10000 
                    ? (state.viewerCount / 10000).toFixed(1) + 'ä¸‡' 
                    : state.viewerCount.toLocaleString());
            }, 300);
        }

        // æ»šåŠ¨åˆ°æœ€æ–°å¼¹å¹•
        function scrollToNewestDanmu() {
            $danmuContainer.scrollTop(0);
            state.isScrollingDanmu = false;
            state.newDanmuCount = 0;
            $newCount.text(0);
            $newDanmuIndicator.removeClass('show');
        }

        // å¤„ç†å¼¹å¹•æ»šåŠ¨äº‹ä»¶
        function handleDanmuScroll() {
            const container = $danmuContainer[0]; 
            state.isScrollingDanmu = container.scrollHeight - container.scrollTop > container.clientHeight + 10;
        }

        // å¤„ç†ç‚¹å‡»ç»§ç»­
        function handleDialogClick(e) {
            if ($(e.target).closest('.map-link').length) return;
            if (!state.isLiveStarted) return;
            
            const nextIndex = state.currentDialogIndex + 1;
            if (nextIndex < liveData.dialogues.length) {
                showHostDialog(nextIndex);
                state.currentDialogIndex = nextIndex;
                
                if (liveData.dialogues[nextIndex].isLast) {
                    $mapLink.addClass('show');
                    $continueHint.text("ç‚¹å‡»å·¦ä¸Šè§’æŸ¥çœ‹åœ°å›¾");
                    state.isLiveComplete = true;
                    // ç§»é™¤å®šæ—¶å™¨æ¸…é™¤é€»è¾‘ï¼Œå¼¹å¹•æŒç»­æ»šåŠ¨
                }
            }
        }

        // åˆå§‹åŒ–äº‹ä»¶ç»‘å®š
        function initLive() {
            // å¼€å§‹ç›´æ’­æŒ‰é’®
            $('#start-live-btn').on('click', startRealLive);
            
            // ç‚¹å‡»ç»§ç»­
            $clickArea.on('click', handleDialogClick);
            
            // æ–°å¼¹å¹•æç¤ºç‚¹å‡»
            $newDanmuIndicator.on('click', scrollToNewestDanmu);
            
            // å¼¹å¹•æ»šåŠ¨ç›‘å¬
            $danmuContainer.on('scroll', handleDanmuScroll);

            // é¡µé¢å¸è½½æ—¶å†æ¸…é™¤å®šæ—¶å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼
            $(window).on('beforeunload', function() {
                if (state.danmuInterval) clearInterval(state.danmuInterval);
            });
        }
    </script>
</body>
</html>